<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>List of Events</title>
		<link href="css/show-users.css" rel="stylesheet" />
	</head>
	<body onload="showEvent()">
		<script type="text/javascript">
			function showEvent() {
				let http = new XMLHttpRequest();
				http.responseType = "json";

				http.open("GET", "/show-events", true);
				http.setRequestHeader(
					"Content-type",
					"application/x-www-form-urlencoded"
				);
				http.send();

				http.onload = () => {
					if (http.status === 200) {
						updateTable(http.response);
					}
				};
			}

			function addEvent() {
				let event = document.getElementById("event").value;
                let id = document.getElementById("id").value;
                let time = document.getElementById("time").value;

				if (!(event && id && time)) {
					alert("ERROR: Fields must not be empty!");
				} else {
					let http = new XMLHttpRequest();
					let params = "event=" + event + "&id=" + id + "&time=" + time;

					http.open("POST", "/add-event", true);
					http.setRequestHeader(
						"Content-type",
						"application/x-www-form-urlencoded"
					);
					http.send(params);

					http.onload = () => {
						if (http.status === 200) {
							updateTable(http.response);
							alert("Event added successfully!");
						} 
                        else if (http.status === 404) {
                            alert("ERROR: Staff ID not found!")
                        }
                        else {
							alert("ERROR: Failed to add event!");
						}
					};
				}
			}

			function updateTable(data) {
				let table = "";
				for (let i = 0; i < data.length; i++) {
					let { id, event, user, time } = data[i];
					table +=
						"<tr><td>" +
						id +
						"</td><td>" +
						event +
						"</td><td>" +
						user +
                        "</td><td>" +
						time +
						"</td></tr>";
				}
				document.getElementById("events").innerHTML = table;
			}

			setInterval("showEvent()", 1000);
		</script>

		<p><b>ADD NEW EVENT</b></p>
		<label for="event"><b>Event Name:</b></label>
		<input id="event" type="text" value="" /><br />
		<br />
		<label for="id"><b>Staff ID:</b></label>
		<input id="id" type="text" value="" /><br /><br />
        <label for="time"><b>Event Time:</b></label>
        <input id="time" type="text" value=""><br /><br />

		<button onclick="addEvent()">Add</button><br /><br /><br />

		<p><b>LIST OF CURRENT EVENTS</b></p>
		<table style="text-align: center">
			<thead style="font-weight: bold">
				<tr>
					<td>ID Number</td>
					<td>Event</td>
					<td>Created By</td>
					<td>Held On</td>
				</tr>
			</thead>
			<tbody id="events"></tbody>
		</table>
	</body>
</html>